<div class="dashboard-container" #chatMessage>
  <!-- Header -->
  <button class="back-button" (click)="goBack()">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
      <path d="M19 12H5M12 19l-7-7 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round"
        stroke-linejoin="round" />
    </svg>

  </button>
  <div class="dashboard-header">
    <!-- <img src="assets/icons/logo.png" alt="Sense Logo" class="logo"> -->
    <h1 class="app-title">Sense</h1>
    <p class="app-subtitle">AI-Powered Underwriting, Claims and Reinsurance Assistant</p>
  </div>

  <!-- Summary Cards -->
  <div class="summary-cards">
    <div class="card"
      (click)="sendCardMessage1('Show me the 5 new submissions assigned in the last 24 hours', '10 new submissions have been assigned to you in the last 24 hours')">

      <div class="card-icon">
        <svg width="25" height="30" viewBox="0 0 23 27" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path stroke-width="0.5" stroke="#5245e4"
            d="M22.8562 3.96091C22.8332 3.92084 22.8061 3.88504 22.7753 3.85459L19.0574 0.145849C19.0234 0.111925 18.9883 0.088685 18.9581 0.0702535C18.9447 0.0617055 18.9307 0.0544932 18.9166 0.0483494C18.8504 0.0165617 18.7773 0 18.7037 0H5.30749C5.03167 0 4.80753 0.223849 4.80753 0.49872V15.7213C3.54064 15.8396 2.36614 16.4057 1.47656 17.3312C0.524322 18.322 0 19.6218 0 20.9914C0 21.6872 0.140587 22.3692 0.418011 23.0186C0.686331 23.6466 1.069 24.2134 1.55502 24.7036C2.56725 25.724 3.90001 26.286 5.30749 26.286C6.71496 26.286 8.02362 25.7625 9.00693 24.812C9.91659 23.9327 10.4733 22.7613 10.5909 21.4904H22.4216C22.6974 21.4904 22.9215 21.2665 22.9215 20.9916V4.24913L23 4.21254L22.8559 3.96091H22.8562ZM19.205 1.70318L21.2155 3.70874H19.205V1.70318ZM5.30909 25.288C2.93385 25.288 1.00151 23.3605 1.00151 20.9911C1.00151 18.6217 2.93385 16.6942 5.30909 16.6942C7.68434 16.6942 9.61667 18.6217 9.61667 20.9911C9.61667 23.3605 7.68434 25.288 5.30909 25.288ZM21.9281 20.4926H10.5949C10.5941 20.4846 10.5935 20.4764 10.5927 20.4683C10.589 20.4344 10.585 20.3984 10.5796 20.3599C10.5751 20.3166 10.5694 20.2744 10.5638 20.2311L10.5617 20.2148C10.5566 20.1785 10.5507 20.1448 10.5451 20.112L10.5429 20.0997C10.5357 20.0556 10.5274 20.0081 10.5178 19.9587L10.5172 19.9555C10.5095 19.9178 10.5014 19.8788 10.4915 19.839C10.4883 19.8254 10.4854 19.8117 10.4822 19.7981C10.4757 19.769 10.469 19.7391 10.4607 19.7076C10.453 19.6758 10.4444 19.6448 10.4356 19.6133L10.4246 19.5735C10.4147 19.5366 10.4042 19.4992 10.3927 19.461C10.3812 19.4239 10.3697 19.3878 10.3579 19.352L10.3472 19.3194C10.3367 19.2877 10.326 19.2551 10.3132 19.2206C10.3006 19.1853 10.2875 19.149 10.2727 19.1114C10.2545 19.063 10.2395 19.0251 10.2245 18.989C10.2133 18.9602 10.201 18.9324 10.1887 18.9038L10.1793 18.8822C10.1632 18.8437 10.145 18.8042 10.1209 18.7545C10.1158 18.7441 10.111 18.7336 10.1059 18.7232C10.0941 18.6981 10.0823 18.673 10.0692 18.6479C10.0499 18.6094 10.0301 18.5699 10.0079 18.5298C9.99987 18.5146 9.99157 18.4994 9.98354 18.4839C9.97443 18.4665 9.96506 18.4492 9.95462 18.4297C9.93346 18.3915 9.91097 18.353 9.88847 18.3148L9.88713 18.3124C9.87803 18.2974 9.86919 18.2822 9.86009 18.2667C9.85018 18.2501 9.84054 18.2333 9.83063 18.217L9.82849 18.2135C9.80519 18.1759 9.7819 18.1398 9.75833 18.1035L9.75592 18.0998C9.74628 18.0853 9.73691 18.0709 9.72727 18.0562C9.71682 18.0402 9.70638 18.0242 9.6946 18.0065C9.66996 17.9705 9.64291 17.9323 9.61426 17.8938C9.60703 17.8839 9.5998 17.874 9.59284 17.8642C9.57945 17.8455 9.56446 17.8244 9.54758 17.8027C9.5283 17.7771 9.50849 17.7522 9.4884 17.7271L9.46537 17.698C9.44261 17.6683 9.41958 17.6403 9.39441 17.6096C9.36201 17.5706 9.32934 17.5337 9.29747 17.4985C9.27739 17.4747 9.25463 17.448 9.22972 17.4215C9.18474 17.3729 9.13921 17.3259 9.09503 17.2808L9.09235 17.2781C9.08592 17.2717 9.0795 17.265 9.07307 17.2586C9.05727 17.2426 9.04147 17.2265 9.0254 17.2113C8.98042 17.1678 8.93409 17.1229 8.88589 17.0785C8.85938 17.0534 8.83233 17.031 8.8085 17.0107C8.77315 16.9792 8.73647 16.9466 8.6971 16.9143L8.69496 16.9124C8.68103 16.9012 8.66657 16.8899 8.65238 16.8785C8.63979 16.8683 8.62694 16.8584 8.61462 16.8485L8.58061 16.8216C8.55464 16.801 8.52893 16.7807 8.50108 16.7599C8.47082 16.7374 8.4403 16.715 8.41004 16.6939L8.38138 16.6733C8.35487 16.6543 8.32863 16.6354 8.29998 16.6159C8.28418 16.6055 8.26811 16.5948 8.25204 16.5844C8.23732 16.5747 8.22259 16.5654 8.20839 16.5558L8.17733 16.5357C8.14975 16.5178 8.1211 16.4991 8.0895 16.4807C8.05736 16.4615 8.02496 16.4423 7.9931 16.4238C7.9548 16.4014 7.91624 16.3789 7.87795 16.3578L7.77673 16.3033C7.73709 16.2822 7.69719 16.2622 7.65756 16.2424L7.62998 16.2291C7.60213 16.2155 7.57455 16.2024 7.5475 16.1904C7.52849 16.1818 7.51001 16.1733 7.49127 16.1647C7.47172 16.1556 7.4519 16.1468 7.43048 16.1372C7.40745 16.127 7.38442 16.1172 7.36086 16.1073L7.3223 16.091C7.27918 16.0731 7.23661 16.0571 7.19537 16.0416C7.15707 16.0266 7.12012 16.0135 7.08424 16.0007L7.08129 15.9996C7.06067 15.9927 7.04005 15.9855 7.01916 15.9785C6.99908 15.9718 6.97926 15.9652 6.95945 15.9582L6.95436 15.9566C6.91848 15.9451 6.88233 15.9337 6.8435 15.9214C6.82127 15.9147 6.79878 15.9083 6.77602 15.9019C6.75647 15.8963 6.73692 15.8909 6.71791 15.885L6.71389 15.884C6.66971 15.8714 6.63355 15.8615 6.60008 15.8532C6.5658 15.8442 6.53314 15.8369 6.50127 15.83C6.48842 15.8271 6.47556 15.8244 6.46244 15.8215L6.43111 15.8145C6.4046 15.8086 6.37488 15.802 6.34328 15.7966C6.30364 15.7889 6.26374 15.7822 6.22492 15.7755L6.20751 15.7726C6.17109 15.7662 6.1336 15.7595 6.09263 15.7536C6.04095 15.7456 5.99275 15.7403 5.94133 15.7349C5.9258 15.7333 5.91 15.7312 5.8942 15.729C5.87546 15.7266 5.85671 15.7242 5.8385 15.7224H5.83556C5.82859 15.7213 5.82136 15.7208 5.8144 15.7199V0.997172H18.2101V4.20746C18.2101 4.4826 18.4345 4.70618 18.7101 4.70618H21.9283V20.4924L21.9281 20.4926Z"
            fill="#6155F5" />
          <path stroke-width="0.5" stroke="#5245e4"
            d="M14.5969 5.54153L14.2609 5.11039C14.1682 4.99179 14.0252 4.9234 13.8686 4.92287C13.7649 4.92207 13.6653 4.95225 13.5831 5.00728H13.498L13.5301 5.04842C13.5092 5.06711 13.4899 5.08768 13.472 5.10985L8.81788 11.0469C8.69872 11.1981 8.67703 11.3995 8.76111 11.5726C8.84386 11.7433 9.02033 11.8537 9.21046 11.8537H11.0351V16.0742C11.0351 16.3493 11.2595 16.5729 11.5351 16.5729H16.1945C16.4704 16.5729 16.6945 16.3491 16.6945 16.0742V11.8537H18.5192C18.7122 11.8537 18.8844 11.746 18.9685 11.5726C19.0526 11.3995 19.0309 11.1981 18.912 11.0475L14.5961 5.54153H14.5967H14.5969ZM17.4957 10.8546H16.1961C15.9203 10.8546 15.6962 11.0785 15.6962 11.3533V15.5739H12.0367V11.3533C12.0367 11.0782 11.8122 10.8546 11.5367 10.8546H10.2371L13.8664 6.22616L17.4957 10.8546Z"
            fill="#6155F5" />
          <path stroke-width="0.5" stroke="#5245e4"
            d="M7.57399 18.7408C7.45054 18.6185 7.27943 18.5482 7.1043 18.5482C6.92917 18.5482 6.761 18.6166 6.63353 18.7421L4.59141 20.7792L3.98167 20.1707C3.85822 20.0476 3.68657 19.9768 3.5109 19.9768C3.33523 19.9768 3.1676 20.0452 3.04014 20.1707L2.33479 20.8743C2.07558 21.1329 2.07558 21.5539 2.33479 21.8125L4.11984 23.5931C4.24517 23.7181 4.41253 23.787 4.59061 23.787C4.76868 23.787 4.93418 23.7184 5.06137 23.5931L8.27987 20.3839C8.40332 20.2607 8.47428 20.0895 8.47428 19.9143C8.47428 19.7391 8.40573 19.5718 8.27987 19.4447L7.57453 18.7411L7.57399 18.7408ZM4.59168 22.8406L3.09128 21.3439L3.51278 20.9235L4.59221 22.0003L7.1051 19.4936L7.5266 19.914L4.59168 22.8406Z"
            fill="#6155F5" />
        </svg>

      </div>
      <h2>5 new submissions</h2>
      <p>have been assigned to you in last 24 hours</p>
    </div>
    <div class="card"
      (click)="sendCardMessage1('List the high-priority submissions that match our risk appetite', 'high priority submissions which meet our risk appetite and have higher chances of conversion')">
      <div class="card-icon">
        <svg width="35" height="30" viewBox="0 0 40 35" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M18.1402 21.6777C18.503 21.6777 18.7962 21.9739 18.7962 22.3384C18.7962 22.7028 18.502 22.999 18.1402 
22.999H9.57087C6.93855 22.999 4.54536 21.9145 2.81072 20.168C1.07608 18.4208 0 16.0105 0 13.3582C0 10.7059 1.07703 8.2963 2.81072 
6.54911C4.54536 4.80192 6.93831 3.71806 9.57087 3.71806H16.1731L12.8163 1.18495C12.5274 0.966405 12.469 0.553537 12.686 0.263499C12.903 
-0.0274999 13.3129 -0.0862753 13.6008 0.131314L18.5208 3.84328C18.5739 3.88143 18.622 3.92797 18.6633 3.9841C18.8802 4.2751 18.8209 4.68797 
18.533 4.90556L13.6018 8.62616C13.3129 8.84375 12.903 8.78498 12.6869 8.49398C12.47 8.20298 12.5293 7.79011 12.8172 7.57252L16.1741 5.04038H9.57183C7.30129 5.04038 5.23654 5.97647 3.73937 7.48448C2.24243 8.99249 1.31283 11.0722 1.31283 13.3591C1.31283 15.6461 2.24219 17.7258 3.73937 19.2338C5.2363 20.7416 7.30129 21.6779 9.57183 21.6779H18.1412H18.1405L18.1402 21.6777ZM22.5227 23C22.1599 23 21.8667 22.7037 21.8667 22.3393C21.8667 21.9749 22.1609 21.6786 22.5227 21.6786H27.3441C27.7068 21.6786 28 21.9749 28 22.3393C28 22.7037 27.7059 23 27.3441 23H22.5227ZM22.5227 13.7166C22.1599 13.7166 21.8667 13.4203 21.8667 13.0559C21.8667 12.6915 22.1609 12.3943 22.5227 12.3943H27.3441C27.7068 12.3943 28 12.6905 28 13.0559C28 13.4213 27.7059 13.7166 27.3441 13.7166H22.5227ZM22.5227 4.4332C22.1599 4.4332 21.8667 4.13692 21.8667 3.77251C21.8667 3.4081 22.1609 3.11183 22.5227 3.11183H27.3441C27.7068 3.11183 28 3.4081 28 3.77251C28 4.13692 27.7059 4.4332 27.3441 4.4332H22.5227Z"
            stroke="#5245e4" stroke-width="1" fill="#6155F5" />
        </svg>

      </div>
      <h2>3 high priority</h2>
      <p>submissions which meets our risk appetite and have higher chances of conversion.</p>
    </div>
    <div class="card"
      (click)="sendCardMessage1('Which submissions have missing information?', '2 submissions need additional information')">
      <div class="card-icon">
        <svg width="26" height="25" viewBox="0 0 26 25" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M12.126 0.261719C12.694 0.0458762 13.3193 0.0458617 13.8877 0.261719C14.4556 0.477419 14.9295 0.894939 15.2236 1.43848V1.43945L25.5781 20.9785H25.5791C26.0232 21.8072 26.0056 22.8146 25.5342 23.627V23.6279C25.0817 24.4088 24.2596 24.8847 23.375 24.8799H21.3262C21.1279 24.8799 20.9432 24.7717 20.8428 24.5938V24.5928C20.7424 24.4146 20.7423 24.1948 20.8428 24.0166C20.9432 23.8387 21.1279 23.7305 21.3262 23.7305H23.376C23.8724 23.7196 24.3268 23.4435 24.5742 23.0049L24.5752 23.0039C24.8025 22.595 24.8305 22.1057 24.6602 21.6768L24.5752 21.4961L14.2148 1.99316H14.2139C14.0581 1.68817 13.7983 1.45103 13.4834 1.32812C13.1679 1.20549 12.8184 1.20541 12.5029 1.32812C12.1874 1.45073 11.9282 1.6882 11.7725 1.99316L10.1729 5.02734C10.0723 5.20839 9.88578 5.31966 9.68457 5.32129C9.48341 5.32281 9.29537 5.21411 9.19238 5.03418C9.08943 4.85417 9.08793 4.63182 9.18848 4.4502L9.18945 4.44824L10.7891 1.43848C11.0831 0.894744 11.558 0.477483 12.126 0.261719ZM8.2998 6.75391C8.50088 6.75247 8.68904 6.86115 8.79199 7.04102C8.89488 7.22108 8.89657 7.44437 8.7959 7.62598L8.79492 7.62695L1.39258 21.5166C1.13268 21.984 1.13268 22.557 1.39258 23.0244V23.0254C1.6397 23.4641 2.09402 23.7401 2.59082 23.751H18.2627C18.4611 23.751 18.6458 23.8589 18.7461 24.0371C18.8465 24.2152 18.8464 24.4351 18.7461 24.6133C18.663 24.7607 18.5218 24.8596 18.3633 24.8896L18.3643 24.8799H2.61328C2.17415 24.8778 1.74307 24.7568 1.36426 24.5293C0.985083 24.3017 0.670886 23.9745 0.454102 23.582L0.453125 23.5811L0.373047 23.4287C-0.0019582 22.6579 0.00857619 21.7439 0.40918 20.9785L7.81152 7.04785C7.9121 6.86672 8.09848 6.75543 8.2998 6.75391ZM12.9932 18.5625C13.4672 18.5625 13.923 18.7547 14.2588 19.0986C14.5527 19.3997 14.7345 19.795 14.7754 20.2158L14.7842 20.3984C14.7823 20.8856 14.5923 21.3516 14.2568 21.6953C13.9208 22.0392 13.4669 22.2327 12.9932 22.2344L12.8164 22.2256C12.4073 22.1839 12.0223 21.9982 11.7285 21.6973C11.3927 21.3532 11.2031 20.8861 11.2031 20.3984C11.2031 19.9107 11.3925 19.4428 11.7285 19.0986C12.0643 18.7548 12.5194 18.5626 12.9932 18.5625ZM12.9932 19.7119C12.814 19.712 12.6424 19.7856 12.5166 19.9141C12.3907 20.0427 12.3204 20.2175 12.3203 20.3984C12.3203 20.5798 12.3912 20.7549 12.5166 20.8838C12.6423 21.0129 12.8143 21.0858 12.9932 21.0859C13.1721 21.0859 13.3437 21.0127 13.4697 20.8838C13.5958 20.755 13.666 20.5796 13.666 20.3984C13.6659 20.2173 13.5959 20.0428 13.4707 19.9141C13.3449 19.7848 13.1722 19.7119 12.9932 19.7119ZM12.6367 6.53906H13.3496C13.8392 6.53707 14.3085 6.74003 14.6484 7.10254C14.9884 7.46519 15.1688 7.955 15.1465 8.45801V8.45898L14.8691 15.9951C14.8511 16.4898 14.6445 16.9568 14.2939 17.2959C13.9868 17.5926 13.5912 17.7708 13.1748 17.8037L12.9961 17.8086H12.9932C12.5175 17.8106 12.0588 17.6232 11.7148 17.2852C11.3709 16.9471 11.1684 16.4841 11.1504 15.9951L10.8408 8.45898V8.45801C10.8213 8.0178 10.9567 7.58769 11.2188 7.24414L11.3389 7.10254C11.6783 6.73993 12.1474 6.53681 12.6367 6.53906ZM12.6377 7.68848C12.4499 7.68488 12.2701 7.7628 12.1426 7.90234C12.0174 8.03818 11.9506 8.22021 11.958 8.40625L12.2676 15.9434L12.2686 15.9561L12.2725 15.9697C12.3392 16.1768 12.4886 16.3463 12.6846 16.4355C12.8809 16.5249 13.1054 16.5249 13.3018 16.4355C13.4984 16.3463 13.6481 16.1768 13.7148 15.9697L13.7188 15.9561V15.9434L14.0283 8.40625C14.0357 8.22021 13.969 8.03819 13.8438 7.90234C13.7162 7.76282 13.5365 7.68478 13.3486 7.68848H12.6377Z"
            fill="#6155F5" stroke-width="0.6" stroke="#5245e4" />
        </svg>

      </div>
      <h2>1 submission</h2>
      <p>needs additional information. Loss run and BOR are missing.</p>
    </div>
  </div>

  <!-- Watchlist -->
  <div class="watchlist">
    <h3>Watchlist summary</h3>
    <div class="watchlist-item">
      <div class="company">Emerald Park Unit Owners Association, Inc</div>
      <div class="details">
        You have received 2 additional years of loss run data and more details on target sub-limits which you had
        requested
      </div>
      <div class="action" (click)="openSubmission()"><img src="assets/icons/view-icon.svg" alt=""></div>
    </div>
    <div class="watchlist-item">
      <div class="company">XYZ Condominium Association</div>
      <div class="details">
        Broker mentioned that acceptable premium is $200,000 against your quote of $225,000
      </div>
      <div class="action" (click)="openSubmission()"><img src="assets/icons/view-icon.svg" alt=""></div>
    </div>
  </div>
  <div class="chat-area" [class.empty]="chatMessages.length === 0">

    <!-- Messages only if > 0 -->
    <div class="chat-messages" *ngIf="chatMessages.length > 0">
      <div *ngFor="let message of chatMessages; let i = index" class="message-wrapper"
        [class.user-message]="message.type === 'user'" [class.bot-message]="message.type === 'bot'"
        [style.animation-delay]="i * 0.3 + 's'">
        <div class="message-bubble">
          <!-- <div class="message-content">{{ message.content }}</div> -->
          <div class="message-content" [innerHTML]="convertMarkdownTables(message.content)"></div>
        </div>

        <div *ngIf="message.actions?.length" class="cta-container">
          <div class="cta-actions-list">
            <button class="cta-btn" *ngFor="let action of message.actions" (click)="sendActionMessage(action)">
              {{ action.label ? action.label : action }}
            </button>
          </div>
        </div>


        <!-- NEW: action icons -->
        <div class="message-icons"
          [ngClass]="{'left-icons': message.type === 'bot', 'right-icons': message.type === 'user'}">

          <!-- Bot Icons -->
          <ng-container *ngIf="message.type === 'bot'">
            <!-- Copy Button -->
            <div class="icon-wrapper">
              <button class="icon-btn" title="Copy" (click)="onCopyClick(message)">
                <img src="assets/icons/copy-icon.svg" alt="Copy">
              </button>
              <span class="tooltip" *ngIf="copiedMessageId === message.id">Copied!</span>
            </div>

            <!-- <span class="tooltip" *ngIf="copiedMessageId === message.id">Copied!</span> -->

            <button class="icon-btn" title="Share">
              <img src="assets/icons/share-icon.svg" alt="Share">
            </button>
            <button class="icon-btn" title="Retry">
              <img src="assets/icons/retry-icon.svg" alt="Retry">
            </button>
          </ng-container>

          <!-- User Icons -->
          <ng-container *ngIf="message.type === 'user'">
            <!-- Copy Button -->
            <div class="icon-wrapper">
              <button class="icon-btn" title="Copy" (click)="onCopyClick(message)">
                <img src="assets/icons/copy-icon.svg" alt="Copy">
              </button>
              <span class="tooltip" *ngIf="copiedMessageId === message.id">Copied!</span>
            </div>

            <!-- <span class="tooltip" *ngIf="copiedMessageId === message.id">Copied!</span> -->

            <button class="icon-btn" title="Edit">
              <img src="assets/icons/edit-icon.svg" alt="Edit">
            </button>
          </ng-container>

        </div>
      </div>
    </div>

    <div class="loading-messages" *ngIf="isLoading">
      <div class="loading-bubble">
        <div class="typing-indicator">
          <span></span><span></span><span></span>
        </div>
      </div>
    </div>

  </div>
  <br><br>


</div>
<div class="chat" style="margin-top: 700 !important;">
  <app-chat-interface (messageSubmitted)="onSendManualMessage1($event)" [disabled]="isLoading">
  </app-chat-interface>
</div>

<app-right-sidebar *ngIf="showRightSidebar"></app-right-sidebar>

<app-email-preview-panel [isOpen]="isEmailPanelOpen" [submissionId]="submissionId" (close)="closeEmailPanel()"
  (emailSent)="onEmailSent()">
</app-email-preview-panel>